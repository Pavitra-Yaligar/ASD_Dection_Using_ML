<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Image Classification Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .probability-meter {
            height: 24px;
            background: linear-gradient(to right, #4ade80, #f59e0b, #ef4444);
            border-radius: 12px;
            position: relative;
        }
        .probability-indicator {
            position: absolute;
            top: -8px;
            width: 2px;
            height: 40px;
            background-color: #000;
            transition: left 0.5s ease;
        }
        .probability-value {
            position: absolute;
            top: -30px;
            transform: translateX(-50%);
            font-weight: bold;
            color: #000;
        }
        .severity-level {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-8">

        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-700 mb-2">Image Classification Result</h1>
            <p class="text-gray-600">Computer vision analysis of the uploaded image</p>
        </div>

        <!-- Card -->
        <div class="bg-white/80 backdrop-blur-md rounded-lg shadow-md overflow-hidden">

            <!-- Uploaded Image -->
            <div class="p-6 border-b text-center">
                <img src="{{ url_for('static', filename=image_path) }}" 
                     alt="Uploaded Image" 
                     class="mx-auto border rounded-lg max-w-xs" />
            </div>

            <!-- Details -->
            <div class="p-6 border-b space-y-2">
                <p><strong class="text-gray-700">Prediction:</strong> {{ prediction }}</p>
                <p><strong class="text-gray-700">Confidence:</strong> {{ confidence }}%</p>
            </div>

            <!-- Probability Meter -->
            <div class="p-6 border-b">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Prediction Confidence</h2>
                <div class="probability-meter relative">
                    <div class="probability-value" id="probabilityValue">{{ confidence }}%</div>
                    <div class="probability-indicator" id="probabilityIndicator"></div>
                </div>
                <div class="severity-level text-sm font-medium mt-2">
                    <span class="text-green-600">Low</span>
                    <span class="text-amber-500">Moderate</span>
                    <span class="text-red-600">High</span>
                </div>
            </div>

            <!-- Pie Chart -->
            <div class="h-64 mb-6 px-6">
                <canvas id="confidenceChart"></canvas>
            </div>

            <!-- Recommendations -->
            <div class="p-6 border-b">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Recommendations</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>If confidence is low, consider reviewing image quality or adding more training data.</li>
                    <li>For moderate confidence, further analysis or expert opinion is recommended.</li>
                    <li>High confidence predictions can be trusted but should be validated clinically.</li>
                </ul>
            </div>

            <!-- Back and Download Buttons -->
            <div class="p-6 text-center space-x-4">
                <a href="{{ url_for('dashboard') }}" class="inline-block bg-sky-600 text-white px-4 py-2 rounded-lg hover:bg-sky-700 transition">Back to Dashboard</a>
                <a href="{{ url_for('download_pdf') }}" class="inline-block border border-sky-600 text-sky-600 px-4 py-2 rounded-lg hover:bg-sky-50 transition">Download Report</a>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>This result is based on image analysis and is not a medical diagnosis.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const probability = parseFloat('{{ confidence | tojson | safe }}');
            if (isNaN(probability) || probability < 0 || probability > 100) {
                console.error('Invalid confidence value:', probability);
                return;
            }
            const probValueEl = document.getElementById('probabilityValue');
            const probIndicatorEl = document.getElementById('probabilityIndicator');

            probValueEl.textContent = `${probability.toFixed(2)}%`;
            probIndicatorEl.style.left = `${probability}%`;

            const ctx = document.getElementById('confidenceChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Prediction Confidence', 'Remaining'],
                    datasets: [{
                        data: [probability, 100 - probability],
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(209, 213, 219, 0.6)'
                        ],
                        borderColor: [
                            'rgba(99, 102, 241, 1)',
                            'rgba(209, 213, 219, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.label}: ${context.raw.toFixed(2)}%`
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
